version: '3.9'

services:
  pg:
    container_name: pg
    image: postgres
    environment:
      - POSTGRES_DB=${DB_NAME}
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASS}
    ports:
      - ${DB_PORT}:5432
    restart: always
    volumes:
      - .postgres:/var/lib/postgres/data
    env_file:
      - .env
#  migrator:
#    build:
#      context: .
#      dockerfile: migration.Dockerfile
#    depends_on:
#      - pg
#    environment:
#      DB_HOST: pg
#      PG_USER: ${PG_USER}
#      PG_PASSWORD: ${PG_PASSWORD}
#      PG_DATABASE_NAME: ${PG_DATABASE_NAME}

  backend:
    build:
      context: .
    environment:
      DB_HOST: pg
      DB_PORT: 5432
      DB_USER: user
      DB_PASSWORD: 1234
      DB_NAME: postgres
    ports:
      - "8080:8080"
    depends_on:
      - pg

#  prometheus:
#    image: prom/prometheus:latest
#    volumes:
#      - ./prometheus.yml:/etc/prometheus/prometheus.yml
#    ports:
#      - "9090:9090"

#  grafana:
#    image: grafana/grafana:latest
#    ports:
#      - "3000:3000"
volumes:
  postgres_volume:
